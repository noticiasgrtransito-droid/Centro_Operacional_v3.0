document.addEventListener("DOMContentLoaded",()=>{carregarRodovias();atualizarNoticias();carregarClima();document.getElementById("btnAtualizar").addEventListener("click",atualizarNoticias);document.getElementById("expandirMapa").addEventListener("click",()=>window.location.href="map.html");});
async function carregarRodovias(){const r=await fetch("dnit.json");const dados=await r.json();const sel=document.getElementById("rodoviaSelect");sel.innerHTML='<option value="todas">Todas as Rodovias</option>'+dados.map(d=>`<option>${d.rodovia}</option>`).join('');}
async function atualizarNoticias(){const div=document.getElementById("listaNoticias");div.innerHTML="<p>Carregando...</p>";const feeds=["https://g1.globo.com/rss/g1/brasil/","https://www.r7.com/rss.xml","https://www.gov.br/prf/pt-br/assuntos/noticias/rss","https://news.google.com/rss/search?q=rodovia+acidente+roubo&hl=pt-BR&gl=BR&ceid=BR:pt-419"];for(const f of feeds){try{const r=await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(f)}`);const t=await r.text();const i=new window.DOMParser().parseFromString(t,"text/xml");[...i.querySelectorAll("item")].slice(0,3).forEach(n=>{div.innerHTML+=`<div class='noticia'><a href='${n.querySelector("link").textContent}' target='_blank'><h3>${n.querySelector("title").textContent}</h3></a><p>${n.querySelector("description").textContent}</p></div>`;});}catch{}}}
async function carregarClima(){try{const r=await fetch("https://wttr.in/SÃ£o+Paulo?format=%C+%t+Umidade:%h+Vento:%w");const t=await r.text();document.getElementById("infoClima").innerText=t;}catch{document.getElementById("infoClima").innerText="Erro ao carregar.";}}